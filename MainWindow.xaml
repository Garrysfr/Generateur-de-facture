<Window x:Class="GenerateurFactures.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Générateur de Factures"
        Height="800"
        Width="1200"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="Générateur de Factures"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="{StaticResource TextPrimaryBrush}"
                       VerticalAlignment="Center"/>
            <Button Content="Paramètres"
                    Style="{StaticResource ModernButton}"
                    Command="{Binding OuvrirParametresCommand}"
                    Margin="20,0,0,0"
                    Padding="20,10"/>
        </StackPanel>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - Invoice Details -->
                <StackPanel Grid.Column="0">

                    <!-- Informations Facture -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Informations Facture"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,15"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Numéro de facture"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FactureActuelle.Numero, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Date"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <DatePicker SelectedDate="{Binding FactureActuelle.Date}"
                                                Padding="10"
                                                FontSize="14"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Informations Client -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Informations Client"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,15"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="Nom/Entreprise"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FactureActuelle.Client.Nom, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="2">
                                    <TextBlock Text="Email"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FactureActuelle.Client.Email, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                                    <TextBlock Text="Adresse"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FactureActuelle.Client.Adresse, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="4" Grid.Column="0">
                                    <TextBlock Text="Code Postal"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FactureActuelle.Client.CodePostal, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="4" Grid.Column="2">
                                    <TextBlock Text="Ville"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FactureActuelle.Client.Ville, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Produits -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <TextBlock Text="Produits"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           VerticalAlignment="Center"/>
                                <Button Content="+ Ajouter"
                                        Style="{StaticResource ModernButton}"
                                        Command="{Binding AjouterProduitCommand}"
                                        Margin="20,0,0,0"/>
                            </StackPanel>

                            <DataGrid ItemsSource="{Binding FactureActuelle.Produits}"
                                      Style="{StaticResource ModernDataGrid}"
                                      Height="300">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Nom du produit"
                                                        Binding="{Binding Nom, UpdateSourceTrigger=PropertyChanged}"
                                                        Width="2*"/>
                                    <DataGridTextColumn Header="Prix unitaire"
                                                        Binding="{Binding Prix, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:C}}"
                                                        Width="*"/>
                                    <DataGridTextColumn Header="Quantité"
                                                        Binding="{Binding Quantite, UpdateSourceTrigger=PropertyChanged}"
                                                        Width="*"/>
                                    <DataGridTextColumn Header="Total"
                                                        Binding="{Binding Total, StringFormat={}{0:C}}"
                                                        Width="*"
                                                        IsReadOnly="True"/>
                                    <DataGridTemplateColumn Width="Auto">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="🗑"
                                                        Command="{Binding DataContext.SupprimerProduitCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        Cursor="Hand"
                                                        FontSize="16"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Right Panel - Summary -->
                <StackPanel Grid.Column="2">

                    <!-- Paramètres -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Paramètres"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,15"/>

                            <StackPanel Margin="0,0,0,10">
                                <TextBlock Text="Réduction (€)"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBox Text="{Binding FactureActuelle.Reduction, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                         Style="{StaticResource ModernTextBox}"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Taux TVA (%)"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBox Text="{Binding FactureActuelle.TauxTva, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                         Style="{StaticResource ModernTextBox}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Récapitulatif -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="Récapitulatif"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,15"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="20"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Total HT :"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding FactureActuelle.TotalHT, StringFormat={}{0:C}}"
                                           FontWeight="Medium"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Réduction :"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding FactureActuelle.Reduction, StringFormat={}{0:C}}"
                                           FontWeight="Medium"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Sous-total :"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding FactureActuelle.SousTotal, StringFormat={}{0:C}}"
                                           FontWeight="Medium"/>

                                <TextBlock Grid.Row="6" Grid.Column="0" Text="TVA :"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding FactureActuelle.MontantTva, StringFormat={}{0:C}}"
                                           FontWeight="Medium"/>

                                <Rectangle Grid.Row="7" Grid.ColumnSpan="2" Height="1" Fill="{StaticResource BorderBrush}" Margin="0,10"/>

                                <TextBlock Grid.Row="8" Grid.Column="0" Text="Total TTC :"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <TextBlock Grid.Row="8" Grid.Column="1" Text="{Binding FactureActuelle.TotalTTC, StringFormat={}{0:C}}"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryBrush}"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Nouvelle Facture"
                    Style="{StaticResource ModernButton}"
                    Command="{Binding NouvelleFactureCommand}"
                    Background="{StaticResource SecondaryBrush}"
                    Margin="0,0,10,0"
                    Padding="20,10"/>
            <Button Content="Aperçu de la facture"
                    Style="{StaticResource ModernButton}"
                    Command="{Binding GenererPdfCommand}"
                    Padding="25,10"/>
        </StackPanel>
    </Grid>
</Window>